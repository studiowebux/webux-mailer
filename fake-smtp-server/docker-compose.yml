version: "2.3"
services:
  backend:
    build: ./smtp-server
    environment:
      PORT: 3030
      SMTP_PORT: 2525
    ports:
      - "3030:3030"
      - "2525:2525"
    restart: always
    healthcheck:
      test:
        [
          "CMD",
          "curl",
          "-k",
          "-H",
          "Origin: http://mailer.webux.lab.127.0.0.1.xip.io:3030",
          "http://localhost:3030/api/v1/healthcheck",
        ]
      interval: 120s
      timeout: 10s
      retries: 5

  app:
    build:
      context: ./frontend
    environment:
      VUE_APP_IO_URL: "https://mailer.webux.lab.127.0.0.1.xip.io:3030"
      SERVER_NAME: mailer.webux.lab.127.0.0.1.xip.io
    ports:
      - "80:80"
      - "443:443"      
    volumes:
      - "./my-app/nginx/logs/:/var/log/nginx/"
    restart: always
    links:
      - backend
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "80"]
      interval: 120s
      timeout: 10s
      retries: 5